# Trading Journal - 项目总览

> 最后更新: 2026年2月6日

## 📋 项目简介

这是一个专为期权交易者设计的**纪律执行型**交易日志Web应用。不同于传统的交易记录工具，本项目的核心目标是通过技术手段强制执行交易纪律，而非单纯记录交易历史。

### 🎯 核心价值主张

**问题**: 大多数期权交易者失败的原因不是缺乏知识，而是缺乏纪律
- 入场无计划（感觉对就买）
- 出场靠情绪（亏损70%才割肉）
- 时间漂移（短线变长线）
- 记录难坚持（工具太复杂）

**解决方案**: 通过强制性工作流和自动化警告系统建立交易纪律
- ✅ Watchlist + OSS v2.2.1 Scanner Score 强制入场计划
- ✅ Stop Loss 规则 + 视觉警告系统 (Health Bar / Glassmorphism)
- ✅ 到期日警告 + 持仓天数追踪
- ✅ 30秒快速操作 + 批量价格同步
- ✅ 自动获取 IV/RV Ratio (Volatility Regime Matrix)
- ✅ 并发数据采集 (Parallel Fetching) 极低响应延迟

---

## 🏗️ 技术架构概览

### 架构图

```
┌─────────────────────────────────────────────┐
│         Frontend (React + TypeScript)        │
│    Vite + React 18 + Tailwind CSS + TS      │
│                                              │
│  ├─ Portfolio (持仓管理)                     │
│  ├─ Watchlist (观察列表)                     │
│  ├─ Scanner (期权扫描器)                     │
│  ├─ History (历史记录)                       │
│  └─ Stats (统计分析)                         │
└─────────────────┬────────────────────────────┘
                  │ HTTPS API
                  ▼
┌─────────────────────────────────────────────┐
│      Vercel Serverless Functions            │
│  ├─ /api/option-price.js (价格代理)         │
│  ├─ /api/batch-option-price.js (批量数据)  │
│  └─ /api/scan-options.js (评分引擎 v2.2)   │
└─────────────────┬────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────┐
│           Supabase Backend                   │
│  PostgreSQL + REST API + Realtime + Auth    │
│                                              │
│  Tables:                                     │
│  ├─ positions (持仓)                         │
│  ├─ transactions (交易记录)                  │
│  └─ greeks_history (Greeks历史)             │
└─────────────────┬────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────┐
│        External Data: CBOE Free API          │
│  cdn.cboe.com/api/global/delayed_quotes/     │
│  (15分钟延迟，免费，无需API Key)              │
└─────────────────────────────────────────────┘
```

### 技术栈选择

| 技术 | 版本 | 选择理由 |
|------|------|----------|
| **Frontend** |
| React | 18.x | 组件化开发，状态管理清晰，生态成熟 |
| TypeScript | 5.x | 类型安全，减少运行时错误，提升开发效率 |
| Vite | 5.x | 极快的开发服务器，现代化构建工具 |
| Tailwind CSS | 3.x | 快速styling，dark mode友好，响应式设计 |
| Recharts | 2.x | 数据可视化，Greeks历史图表 |
| **Backend** |
| Supabase | Cloud | 免费tier够用，PostgreSQL可靠，实时同步 |
| PostgreSQL | 15.x | 关系型数据库，ACID保证，复杂查询支持 |
| **Deployment** |
| Vercel | Cloud | 免费，自动HTTPS，全球CDN，Serverless Functions |
| GitHub | - | 版本控制，自动部署触发 |
| **Data Source** |
| CBOE API | Free | 官方数据源，免费，无速率限制，包含Greeks |

---

## 📊 核心功能模块

### 1. Portfolio (持仓管理)
**目标**: 实时监控活跃持仓，强制执行止损纪律

**功能**:
- 📈 实时P&L计算（百分比和美元）
- 🔄 批量/单个价格自动更新
- ⚠️ 多级警告系统（危险/警告/信息）
- 📊 Greeks历史图表（IV和Delta）
- 🎯 Entry Score vs Current Score对比 (v2.2.1 趋势追踪)
- 🛑 止损触发视觉提示 (Glassmorphism & Health Bar)

**P&L 计算逻辑 (v2.2.1 保守模式)**:
- 卖方策略：以期权 Ask 价格计算平仓成本，优先反映流动性风险。
- 买方策略：以期权 Bid 价格计算套现价值。
- 只有在流动性极佳时，P&L 才会趋向 Mid 价格。

**警告系统**:
| 级别 | 条件 | 显示 |
|------|------|------|
| 🔴 Danger | Score < 60 | "Score < 60" |
| 🔴 Danger | 亏损 ≥ 40% | "-40% loss" |
| 🔴 Danger | 价格触及止损 | "⚠️ HIT STOP" |
| 🟡 Warning | Score < 70 | "Score < 70" |
| 🟡 Warning | 距到期 ≤ 7天 | "7d to exp!" |
| 🟡 Warning | 距止损 ≤ 5% | "5% to stop" |
| 🔵 Info | Score超过2天未更新 | "Update score" |

### 2. Watchlist (观察列表)
**目标**: 强制入场计划，避免冲动交易

**功能**:
- 📝 记录理想入场价和Scanner Score
- 🎯 设置技术止损条件
- 📊 当前价格vs理想价格对比
- ✅ 一键转为活跃持仓

**工作流**:
1. Scanner发现机会 → 添加到Watchlist
2. 记录理想入场价、Score、止损条件
3. 等待价格到达理想区间
4. 确认后转为Active Position

### 3. Scanner (期权扫描器)
**目标**: 基于量化指标发现高质量期权机会

**核心算法**: OSS (Options Scoring System)
- **LOQ** (Long Option Quality): 买方评分系统 (v2.2 Harmony)
- **CSQ** (Credit Spread Quality): 卖方评分系统
- **Volatility Regime Matrix**: 4-Quadrant 混合动力引擎 (IV Term + IV/RV)
- **Day Trade Mode**: 自动调整杠杆/爆发力引擎权重

**扫描流程**:
1. 输入Ticker和策略（Long/Short）
2. 获取完整期权链数据
- 3. 应用硬过滤器（DTE、Strike Range、Volume、Spread）
- 4. 计算原始指标（Lambda、Gamma Efficiency、Theta Burn、Composite Spread v2.2.1）
- 5. Z-Score标准化
- 6. 加权计算最终得分（0-100）
- 7. 按得分排序展示

**LOQ Score (买方 - v2.2.1)**:
**80-100分 - 优秀机会**
- ✅ 高杠杆（Lambda 5-15）
- ✅ 高爆发力（Gamma Eff 0.01-0.05）
- ✅ 低时间衰减（Theta Burn <0.02）
- ✅ ATM区间（Delta 0.30-0.50）
- ✅ 波动率价值区 (IV < RV)
- ✅ 流动性极佳 (Composite Spread < 5%)

### 4. History (历史记录)
**目标**: 回顾已平仓交易，分析盈亏模式

**功能**:
- 📊 总P&L统计
- 📈 胜率和平均盈亏
- 🔍 按时间排序的交易历史
- 💰 每笔交易的详细P&L

### 5. Stats (统计分析)
**目标**: 长期绩效追踪和模式识别

**指标**:
- 总体胜率
- 平均持仓时间
- 最佳/最差交易
- Setup类型分析
- 月度P&L趋势

---

## 🗄️ 数据模型

### Positions (持仓表)
```typescript
interface Position {
  id: string;                    // UUID主键
  ticker: string;                // 股票代码 e.g. "QQQ"
  strike: number;                // 行权价
  type: 'Call' | 'Put';          // 期权类型
  expiration: string;            // 到期日 (YYYY-MM-DD)
  status: 'watchlist' | 'active' | 'closed';
  setup: string;                 // 交易设置类型
  entry_score: number;           // 入场时Scanner Score
  current_score: number;         // 当前Scanner Score
  score_updated_at: string;      // Score最后更新时间
  ideal_entry: number;           // 理想入场价
  current_price: number;         // 当前期权价格
  stop_reason: string;           // 技术止损条件
  target_price: number;          // 目标价
  notes: string;                 // 交易笔记
  created_at: string;            // 创建时间
  closed_at: string;             // 平仓时间
}
```

### Transactions (交易记录表)
```typescript
interface Transaction {
  id: string;                    // UUID主键
  position_id: string;           // 关联Position ID
  type: 'Open' | 'Size Up' | 'Size Down' | 'Take Profit' | 'Close';
  quantity: number;              // 数量（正=买入，负=卖出）
  price: number;                 // 成交价
  date: string;                  // 交易时间
  note: string;                  // 交易备注
}
```

### Greeks History (Greeks历史表)
```typescript
interface GreeksHistory {
  id: string;                    // UUID主键
  position_id: string;           // 关联Position ID
  iv: number;                    // 隐含波动率
  delta: number;                 // Delta值
  recorded_at: string;           // 记录时间
}
```

---

## 🚀 部署信息

### 当前部署
- **网址**: https://trading-journal-git-main-chans-projects-332f0497.vercel.app
- **Hosting**: Vercel (自动部署)
- **GitHub**: https://github.com/yauyueson/trading-journal
- **Supabase**: https://irejefxhgetulqmxponl.supabase.co

### 更新流程
1. 本地修改代码
2. Git commit & push到GitHub
3. Vercel自动检测并重新部署（~30秒）
4. 新版本自动上线

### 环境变量
```bash
VITE_SUPABASE_URL=https://irejefxhgetulqmxponl.supabase.co
VITE_SUPABASE_ANON_KEY=sb_publishable_STPE7Kl1Pnlwm6a-mCa-9g_U7hvret6
```

---

## 📱 用户体验设计

### 设计原则
1. **移动优先**: 所有功能在iPhone上完美运行
2. **30秒原则**: 任何操作不超过30秒完成
3. **视觉警告**: 危险状态用红色高亮，不可忽视
4. **自动化优先**: 能自动获取的数据绝不手动输入
5. **Dark Mode**: 默认深色主题，护眼且专业

### 响应式设计
- **Desktop**: 多列布局，完整信息展示
- **Tablet**: 两列布局，适度简化
- **Mobile**: 单列卡片，核心信息优先

### 交互设计
- **Loading States**: 所有异步操作显示加载状态
- **Error Handling**: 友好的错误提示和重试机制
- **Optimistic Updates**: 乐观更新提升响应速度
- **Confirmation Dialogs**: 危险操作需要二次确认

---

## 🔐 安全性

### 认证
- Supabase Auth (Email/Password)
- Row Level Security (RLS) 策略
- 每个用户只能访问自己的数据

### API安全
- CORS配置限制来源
- Serverless Functions隔离
- 无敏感信息暴露在前端

---

## 📈 未来规划

### 短期 (1-2个月)
- [ ] 添加更多Setup类型模板
- [ ] 实现交易日志导出（CSV/PDF）
- [ ] 优化Scanner性能（缓存机制）
- [ ] 添加推送通知（价格警告）

### 中期 (3-6个月)
- [ ] 多账户支持
- [ ] 社交功能（分享Setup）
- [ ] AI辅助分析（模式识别）
- [ ] 回测功能

### 长期 (6-12个月)
- [ ] 移动App（React Native）
- [ ] 实时数据（付费API）
- [ ] 自动交易集成（Broker API）
- [ ] 社区市场（Setup模板交易）

---

## 📚 相关文档

- [技术路径详解](./02_技术路径.md)
- [核心算法说明](./03_核心算法.md)
- [数据库设计](./04_数据库设计.md)
- [API文档](./05_API文档.md)
- [用户工作流](./06_用户工作流.md)

---

*文档维护者: Trading Journal Team*
*最后更新: 2026年2月6日*
